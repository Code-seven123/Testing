name: Extract Vendor Image from Google Drive

on:
  workflow_dispatch: # Menjalankan workflow secara manual

jobs:
  download_and_extract_vendor:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Install tools
      run: |
        sudo apt update
        sudo apt install -y wget unzip

    - name: Download firmware from Google Drive
      env:
        FILE_ID: "1EbYQ5xMFlfyh8RqjDhhYMTDVAXOVLUCv" # Ganti dengan ID file Google Drive Anda
        FILE_NAME: "firmware.zip"
      run: |
        wget --no-check-certificate "https://docs.google.com/uc?export=download&id=${FILE_ID}" -O $FILE_NAME

    - name: Extract firmware
      run: |
        mkdir firmware_extracted
        unzip firmware.zip -d firmware_extracted # Ekstrak file ZIP

    - name: Extract AP.tar.md5
      run: |
        cd firmware_extracted
        tar -xf AP.tar.md5 # Ekstrak file AP untuk mencari vendor.img

    - name: Find and save vendor.img
      run: |
        find ./firmware_extracted -name "vendor.img" -exec mv {} ./vendor.img \;

    - name: Upload vendor.img
      uses: actions/upload-artifact@v3
      with:
        name: vendor-img
        path: vendor.img